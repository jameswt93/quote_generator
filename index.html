<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quote Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <style>
        body {
            background-color: #f0f0f0;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #root {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }
        .container {
            max-width: 400px;
            width: 100%;
            background-color: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h1 {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 24px;
        }
        .error {
            background-color: #fee2e2;
            color: #b91c1c;
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 4px;
        }
        .form-group {
            margin-bottom: 16px;
        }
        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 4px;
        }
        input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            box-sizing: border-box;
        }
        input[type="number"]:focus {
            outline: none;
            border-color: #2563eb;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }
        input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin-right: 8px;
        }
        button {
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 4px;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }
        button:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        .btn-primary {
            background-color: #2563eb;
        }
        .btn-primary:not(:disabled):hover {
            background-color: #1d4ed8;
        }
        .btn-secondary {
            background-color: #16a34a;
        }
        .btn-secondary:hover {
            background-color: #15803d;
        }
        .quote-details {
            margin-top: 24px;
        }
        .quote-details h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        .quote-details p {
            margin-bottom: 8px;
        }
        .quote-details h3 {
            font-size: 18px;
            font-weight: 500;
            margin: 16px 0 8px;
        }
        .quote-details .total {
            font-size: 18px;
            font-weight: bold;
            margin-top: 16px;
        }
        @media (max-width: 640px) {
            .container {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="container">
            <h1>Quote Generator</h1>
            <div id="error" class="error" style="display: none;"></div>
            <form id="quote-form" onsubmit="calculateQuote(event)">
                <div class="form-group">
                    <label>Total Positions</label>
                    <input type="number" id="total-positions" min="0" required />
                </div>
                <div class="form-group">
                    <label>Position 1 (.5D)</label>
                    <input type="number" id="position1" min="0" required />
                </div>
                <div class="form-group">
                    <label>Position 2 (.1.1 LD)</label>
                    <input type="number" id="position2" min="0" required />
                </div>
                <div class="form-group">
                    <label>Position 3 (1.2 LDR)</label>
                    <input type="number" id="position3" min="0" required />
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="specialty-doors" />
                    <label>Specialty or Interior Doors</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="semi-annual" />
                    <label>Semi-Annual Service (12% Surcharge)</label>
                </div>
                <button type="submit" class="btn-primary">Generate Quote</button>
                <div id="quote-result" class="quote-details"></div>
            </form>
        </div>
    </div>

    <script type="text/javascript">
        console.log('Starting Quote Generator...');
        console.log('jsPDF loaded:', typeof window.jspdf !== 'undefined');

        const PricingTier = {
            above99: { position1: 55, position2: 65, position3: 75, scissorLift: 100, sectionalDoors: 100, rollingSteelDoor: 100, highSpeedDoors: 166, fireDoorBelow10: 200 },
            range49to99: { position1: 70, position2: 75, position3: 90, scissorLift: 100, sectionalDoors: 100, rollingSteelDoor: 100, highSpeedDoors: 166, fireDoorBelow10: 200 },
            range16to49: { position1: 90, position2: 120, position3: 150, scissorLift: 100, sectionalDoors: 100, rollingSteelDoor: 100, highSpeedDoors: 166, fireDoorBelow10: 200 },
            range10to15: { position1: 150, position2: 190, position3: 200, scissorLift: 100, sectionalDoors: 100, rollingSteelDoor: 100, highSpeedDoors: 166, fireDoorBelow10: 200 },
            range1to10: { position1: 200, position2: 225, position3: 250, scissorLift: 100, sectionalDoors: 100, rollingSteelDoor: 100, highSpeedDoors: 166, fireDoorBelow10: 200 }
        };

        function calculateQuote(event) {
            event.preventDefault();
            console.log('Calculating quote...');
            const errorDiv = document.getElementById('error');
            const resultDiv = document.getElementById('quote-result');
            errorDiv.style.display = 'none';
            resultDiv.innerHTML = '';

            const total = parseInt(document.getElementById('total-positions').value);
            const p1 = parseInt(document.getElementById('position1').value);
            const p2 = parseInt(document.getElementById('position2').value);
            const p3 = parseInt(document.getElementById('position3').value);
            const specialtyDoors = document.getElementById('specialty-doors').checked;
            const semiAnnual = document.getElementById('semi-annual').checked;

            if (isNaN(total) || isNaN(p1) || isNaN(p2) || isNaN(p3) || p1 + p2 + p3 !== total) {
                errorDiv.textContent = 'Invalid input: Ensure all fields are numbers and positions sum to total.';
                errorDiv.style.display = 'block';
                return;
            }
            if (total < 1) {
                errorDiv.textContent = 'Total positions must be at least 1.';
                errorDiv.style.display = 'block';
                return;
            }

            let tier = total >= 99 ? PricingTier.above99 :
                       total >= 49 ? PricingTier.range49to99 :
                       total >= 16 ? PricingTier.range16to49 :
                       total >= 10 ? PricingTier.range10to15 : PricingTier.range1to10;

            const costPosition1 = p1 * tier.position1;
            const costPosition2 = p2 * tier.position2;
            const costPosition3 = p3 * tier.position3;
            const scissorLiftCost = total * tier.scissorLift;
            const specialtyCost = specialtyDoors ? (tier.sectionalDoors + tier.rollingSteelDoor + tier.highSpeedDoors + tier.fireDoorBelow10) : 0;
            let totalCost = costPosition1 + costPosition2 + costPosition3 + scissorLiftCost + specialtyCost;
            if (semiAnnual) totalCost *= 1.12;

            const quote = {
                total, p1, p2, p3, specialtyDoors, semiAnnual, totalCost,
                costPosition1, costPosition2, costPosition3, scissorLiftCost, specialtyCost
            };
            window.currentQuote = quote;

            resultDiv.innerHTML = `
                <h2>Quote Details</h2>
                <p><strong>Total Positions:</strong> ${total}</p>
                <p><strong>Position 1 (.5D):</strong> ${p1}</p>
                <p><strong>Position 2 (.1.1 LD):</strong> ${p2}</p>
                <p><strong>Position 3 (1.2 LDR):</strong> ${p3}</p>
                <p><strong>Specialty Doors:</strong> ${specialtyDoors ? 'Yes' : 'No'}</p>
                <p><strong>Service Frequency:</strong> ${semiAnnual ? 'Semi-Annual' : 'Quarterly'}</p>
                <h3>Cost Breakdown</h3>
                ${p1 > 0 ? `<p><strong>Position 1 (.5D):</strong> $${costPosition1.toFixed(2)}</p>` : ''}
                ${p2 > 0 ? `<p><strong>Position 2 (.1.1 LD):</strong> $${costPosition2.toFixed(2)}</p>` : ''}
                ${p3 > 0 ? `<p><strong>Position 3 (1.2 LDR):</strong> $${costPosition3.toFixed(2)}</p>` : ''}
                <p><strong>Scissor Lift (Per Day):</strong> $${scissorLiftCost.toFixed(2)}</p>
                ${specialtyCost > 0 ? `<p><strong>Specialty Doors:</strong> $${specialtyCost.toFixed(2)}</p>` : ''}
                <p class="total"><strong>Total Cost:</strong> $${totalCost.toFixed(2)}</p>
                <button onclick="generatePDF()" class="btn-secondary">Export as PDF</button>
            `;
        }

        function generatePDF() {
            console.log('Generating PDF...');
            const { jsPDF } = window.jspdf;
            const quote = window.currentQuote;
            if (!jsPDF || !quote) {
                document.getElementById('error').textContent = 'PDF generation failed. Try hosting the file or check console (F12).';
                document.getElementById('error').style.display = 'block';
                return;
            }

            const doc = new jsPDF();
            doc.setFontSize(18);
            doc.text('Service Quote', 20, 20);
            doc.setFontSize(12);
            let yOffset = 40;

            doc.text('Summary', 20, yOffset);
            yOffset += 10;
            doc.text(`Total Positions: ${quote.total}`, 20, yOffset);
            yOffset += 10;
            doc.text(`Position 1 (.5D): ${quote.p1}`, 20, yOffset);
            yOffset += 10;
            doc.text(`Position 2 (.1.1 LD): ${quote.p2}`, 20, yOffset);
            yOffset += 10;
            doc.text(`Position 3 (1.2 LDR): ${quote.p3}`, 20, yOffset);
            yOffset += 10;
            doc.text(`Specialty Doors: ${quote.specialtyDoors ? 'Yes' : 'No'}`, 20, yOffset);
            yOffset += 10;
            doc.text(`Service Frequency: ${quote.semiAnnual ? 'Semi-Annual' : 'Quarterly'}`, 20, yOffset);
            yOffset += 20;

            doc.text('Cost Breakdown', 20, yOffset);
            yOffset += 10;
            if (quote.p1 > 0) {
                doc.text(`Position 1 (.5D): $${quote.costPosition1.toFixed(2)}`, 20, yOffset);
                yOffset += 10;
            }
            if (quote.p2 > 0) {
                doc.text(`Position 2 (.1.1 LD): $${quote.costPosition2.toFixed(2)}`, 20, yOffset);
                yOffset += 10;
            }
            if (quote.p3 > 0) {
                doc.text(`Position 3 (1.2 LDR): $${quote.costPosition3.toFixed(2)}`, 20, yOffset);
                yOffset += 10;
            }
            doc.text(`Scissor Lift (Per Day): $${quote.scissorLiftCost.toFixed(2)}`, 20, yOffset);
            yOffset += 10;
            if (quote.specialtyCost > 0) {
                doc.text(`Specialty Doors: $${quote.specialtyCost.toFixed(2)}`, 20, yOffset);
                yOffset += 10;
            }

            yOffset += 10;
            doc.text('Total', 20, yOffset);
            yOffset += 10;
            doc.text(`Total Cost: $${quote.totalCost.toFixed(2)}`, 20, yOffset);

            doc.save('quote.pdf');
        }

        // Attempt to load React for enhanced interface
        const reactScript = document.createElement('script');
        reactScript.src = 'https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.development.js';
        reactScript.onload = () => {
            console.log('React loaded');
            loadReactDOM();
        };
        reactScript.onerror = () => console.error('Failed to load React CDN');
        document.head.appendChild(reactScript);

        function loadReactDOM() {
            const reactDOMScript = document.createElement('script');
            reactDOMScript.src = 'https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.development.js';
            reactDOMScript.onload = () => {
                console.log('ReactDOM loaded');
                loadBabel();
            };
            reactDOMScript.onerror = () => console.error('Failed to load ReactDOM CDN');
            document.head.appendChild(reactDOMScript);
        }

        function loadBabel() {
            const babelScript = document.createElement('script');
            babelScript.src = 'https://cdn.jsdelivr.net/npm/babel-standalone@7.24.7/babel.min.js';
            babelScript.onload = () => {
                console.log('Babel loaded');
                loadReactApp();
            };
            babelScript.onerror = () => console.error('Failed to load Babel CDN');
            document.head.appendChild(babelScript);
        }

        function loadReactApp() {
            const script = document.createElement('script');
            script.type = 'text/babel';
            script.innerHTML = `
                const { useState } = React;
                const { jsPDF } = window.jspdf;

                function App() {
                    const [totalPositions, setTotalPositions] = useState('');
                    const [position1, setPosition1] = useState('');
                    const [position2, setPosition2] = useState('');
                    const [position3, setPosition3] = useState('');
                    const [hasSpecialtyDoors, setHasSpecialtyDoors] = useState(false);
                    const [isSemiAnnual, setIsSemiAnnual] = useState(false);
                    const [quote, setQuote] = useState(null);
                    const [error, setError] = useState('');

                    const isInputValid = () => {
                        const total = parseInt(totalPositions);
                        const p1 = parseInt(position1);
                        const p2 = parseInt(position2);
                        const p3 = parseInt(position3);
                        return !isNaN(total) && !isNaN(p1) && !isNaN(p2) && !isNaN(p3) &&
                               total >= 0 && p1 >= 0 && p2 >= 0 && p3 >= 0 && (p1 + p2 + p3) === total;
                    };

                    const calculateQuote = (e) => {
                        e.preventDefault();
                        setError('');
                        const total = parseInt(totalPositions);
                        const p1 = parseInt(position1);
                        const p2 = parseInt(position2);
                        const p3 = parseInt(position3);

                        if (isNaN(total) || isNaN(p1) || isNaN(p2) || isNaN(p3) || (p1 + p2 + p3) !== total) {
                            setError('Invalid input: Ensure all fields are numbers and positions sum to total.');
                            setQuote(null);
                            return;
                        }
                        if (total < 1) {
                            setError('Total positions must be at least 1.');
                            setQuote(null);
                            return;
                        }

                        let tier = ${JSON.stringify(PricingTier)};
                        tier = total >= 99 ? tier.above99 :
                               total >= 49 ? tier.range49to99 :
                               total >= 16 ? tier.range16to49 :
                               total >= 10 ? tier.range10to15 : tier.range1to10;

                        const costPosition1 = p1 * tier.position1;
                        const costPosition2 = p2 * tier.position2;
                        const costPosition3 = p3 * tier.position3;
                        const scissorLiftCost = total * tier.scissorLift;
                        const specialtyCost = hasSpecialtyDoors ? (tier.sectionalDoors + tier.rollingSteelDoor + tier.highSpeedDoors + tier.fireDoorBelow10) : 0;
                        let totalCost = costPosition1 + costPosition2 + costPosition3 + scissorLiftCost + specialtyCost;
                        if (isSemiAnnual) totalCost *= 1.12;

                        const quoteData = {
                            total, p1, p2, p3, hasSpecialtyDoors, isSemiAnnual, totalCost,
                            costPosition1, costPosition2, costPosition3, scissorLiftCost, specialtyCost
                        };
                        setQuote(quoteData);
                        window.currentQuote = quoteData;
                    };

                    return (
                        <div className="container">
                            <h1>Quote Generator (React)</h1>
                            {error && (
                                <div className="error">{error}</div>
                            )}
                            <form onSubmit={calculateQuote}>
                                <div className="form-group">
                                    <label>Total Positions</label>
                                    <input
                                        type="number"
                                        value={totalPositions}
                                        onChange={e => setTotalPositions(e.target.value)}
                                        min="0"
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Position 1 (.5D)</label>
                                    <input
                                        type="number"
                                        value={position1}
                                        onChange={e => setPosition1(e.target.value)}
                                        min="0"
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Position 2 (.1.1 LD)</label>
                                    <input
                                        type="number"
                                        value={position2}
                                        onChange={e => setPosition2(e.target.value)}
                                        min="0"
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Position 3 (1.2 LDR)</label>
                                    <input
                                        type="number"
                                        value={position3}
                                        onChange={e => setPosition3(e.target.value)}
                                        min="0"
                                        required
                                    />
                                </div>
                                <div className="checkbox-group">
                                    <input
                                        type="checkbox"
                                        checked={hasSpecialtyDoors}
                                        onChange={e => setHasSpecialtyDoors(e.target.checked)}
                                    />
                                    <label>Specialty or Interior Doors</label>
                                </div>
                                <div className="checkbox-group">
                                    <input
                                        type="checkbox"
                                        checked={isSemiAnnual}
                                        onChange={e => setIsSemiAnnual(e.target.checked)}
                                    />
                                    <label>Semi-Annual Service (12% Surcharge)</label>
                                </div>
                                <button type="submit" disabled={!isInputValid()} className="btn-primary">
                                    Generate Quote
                                </button>
                                {quote && (
                                    <div className="quote-details">
                                        <h2>Quote Details</h2>
                                        <p><strong>Total Positions:</strong> {quote.total}</p>
                                        <p><strong>Position 1 (.5D):</strong> {quote.p1}</p>
                                        <p><strong>Position 2 (.1.1 LD):</strong> {quote.p2}</p>
                                        <p><strong>Position 3 (1.2 LDR):</strong> {quote.p3}</p>
                                        <p><strong>Specialty Doors:</strong> {quote.hasSpecialtyDoors ? 'Yes' : 'No'}</p>
                                        <p><strong>Service Frequency:</strong> {quote.isSemiAnnual ? 'Semi-Annual' : 'Quarterly'}</p>
                                        <h3>Cost Breakdown</h3>
                                        {quote.p1 > 0 && <p><strong>Position 1 (.5D):</strong> ${quote.costPosition1.toFixed(2)}</p>}
                                        {quote.p2 > 0 && <p><strong>Position 2 (.1.1 LD):</strong> ${quote.costPosition2.toFixed(2)}</p>}
                                        {quote.p3 > 0 && <p><strong>Position 3 (1.2 LDR):</strong> ${quote.costPosition3.toFixed(2)}</p>}
                                        <p><strong>Scissor Lift (Per Day):</strong> ${quote.scissorLiftCost.toFixed(2)}</p>
                                        {quote.specialtyCost > 0 && <p><strong>Specialty Doors:</strong> ${quote.specialtyCost.toFixed(2)}</p>}
                                        <p className="total"><strong>Total Cost:</strong> ${quote.totalCost.toFixed(2)}</p>
                                        <button onClick={generatePDF} className="btn-secondary">Export as PDF</button>
                                    </div>
                                )}
                            </form>
                        </div>
                    );
                }

                try {
                    console.log('Rendering React app...');
                    const root = ReactDOM.createRoot(document.getElementById('root'));
                    root.render(<App />);
                    console.log('React app rendered successfully.');
                } catch (e) {
                    console.error('Failed to render React app:', e.message);
                }
            `;
            document.body.appendChild(script);
        }
    </script>
</body>
</html>